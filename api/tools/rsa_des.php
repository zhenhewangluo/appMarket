<?php
/**
* 测试代码：
*
* @author  	 
* @version   
* @copyright 
* @link      http://***
* @create    2010-5-11
*/
include_once("../inc/funcRsa.inc.php");
include_once('../class/BigInteger.class.php');
include_once('../class/des.class.php');

$d_private = "146113750824343670942128097542444399259964660941491643821942210186083077109537583878673644902341866788189279987166560705020110275786201076287222163397806550798955350352765927156473489080296241902430288870197651617563532347924061387350273794499879003822039725726836935830155947973311169627355758798481984876609";//103140670267191716337144268259692635311014799974978156902041128395373650672080265612387935193233348966644006827464758677893052188720348645465720552676384014569108176930079819232567239968708342806204981648544172818200422533318424362333563728881195445401962044213087962278816945154426367038482377395279948736025

$key_private = new Math_BigInteger($d_private);

$m = "153400244902201255327025649247712075392482122006320291252701310857447882617707366311941475489631855114980790121090203910753924246190571894409773146908273251771112984362707682509615031664173679643452775818193013369202795463751003187532512848212012614635729858507630181976767562646363293565072310969559913791943";//125242242467304226980818040029626771449089399969616333381049941622953718673240322529328207020354780888067722576207206966012991943446137640922660671107037754599453565985942582513009492907982173446675216454634592761000191710251638590123948630732326307922952494464857505415177402322499891218582307842351942219477

$modulo = new  Math_BigInteger($m);

$e_public = "65537";//17

$key_public = new Math_BigInteger($e_public);

//$encrypted = rsa_encrypt("smartKey001", $e_public->toString(), $m->toString(), 1024);
/*
$temp = new Math_BigInteger("89810277746679693421126525582633105705364727431843977750606673726363315437568879059711364598951594481064703108577715178709050813533131602010701664599510634962697249212669254406956612780788016297401488209234249720433621947410470241810676241816533622100849583334824861184413610607817303665983112552411719802019
");
$encrypted = $temp->toBytes();

$decrypted = rsa_decrypt($encrypted, $d_private->toString(), $m->toString(),1024);

echo $decrypted;
*/
//$keyEncode = __getRequest('keyEncode'); //key密文
//$stringEncode = __getRequest('stringEncode'); //密文
$keyEncode = "1654403488892331276047388699742789909078402506820261478742212512991463986883139514175634726403862107801290186042141924393168515650424395962547023231609481332161934420171439302488884067427387901221397679866960640936235227442994312713830112146602082077576505184741926426286005425555316428266045840565656431670";//9987501780563344410284448816267600713393428318003002600126163546491438746026897583366006092065088049510742921899267909441147411291656753757258499170711882657408728559681608323870705543478723351585740585963447335909575069912552372449952814273117044101091552370039572924635409956320063501043830484333202103886
$stringEncode = "0nPA984Vt7wnF3feaPjZgPZ3W+os2/wAV4ny5oc9KxM7KK1lHQ1b90LfEKLhHHM6KljFWfYHBXo=";

$keyEncodeBI = new Math_BigInteger($keyEncode);
$keyEncodeByte = $keyEncodeBI->toBytes();

$keyDecode = rsa_decrypt($keyEncodeByte, $key_private->toString(), $modulo->toString(),1024);//解码后key
//echo $keyDecode."---<br />";
$aKeyDecode = explode("|",$keyDecode);
//print_r($aKeyDecode);
$deskey = $aKeyDecode[1];
//echo $deskey;
//exit();
$crypt = new CookieCrypt($deskey);
$decode = $crypt->decrypt($stringEncode);
echo $decode;
/*
//处理
{
		$response = array2json(array(
				"proto" => 14,
				"reqsuccess" => 'true',
				"payid" => '1234',
				));	
}
$encodeRes = $crypt->encrypt($response);
echo $encodeRes;
*/
exit();

define("RSA_PUBLIC_KEY",65537);   //public_key
define("RSA_PRIVATE_KEY","146113750824343670942128097542444399259964660941491643821942210186083077109537583878673644902341866788189279987166560705020110275786201076287222163397806550798955350352765927156473489080296241902430288870197651617563532347924061387350273794499879003822039725726836935830155947973311169627355758798481984876609");//private_key
define("RSA_MODULO",'153400244902201255327025649247712075392482122006320291252701310857447882617707366311941475489631855114980790121090203910753924246190571894409773146908273251771112984362707682509615031664173679643452775818193013369202795463751003187532512848212012614635729858507630181976767562646363293565072310969559913791943');

?>